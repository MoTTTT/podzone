<!DOCTYPE html>

<html class="writer-html5" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><meta content="Martin Colley" name="author"/><link href="https://musings.thruhere.net/podzone/externalServices/" rel="canonical"/>
<link href="../img/favicon.ico" rel="shortcut icon"/>
<title>Service Dependencies - Podzone</title>
<link href="../css/theme.css" rel="stylesheet"/>
<link href="../css/theme_extra.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" rel="stylesheet"/>
<script>
        // Current page data
        var mkdocs_page_name = "Service Dependencies";
        var mkdocs_page_input_path = "externalServices.md";
        var mkdocs_page_url = "/podzone/externalServices/";
      </script>
<!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
</head>
<body class="wy-body-for-nav" role="document">
<div class="wy-grid-for-nav">
<nav class="wy-nav-side stickynav" data-toggle="wy-nav-shift">
<div class="wy-side-scroll">
<div class="wy-side-nav-search">
<a class="icon icon-home" href=".."> Podzone
        </a><div role="search">
<form action="../search.html" class="wy-form" id="rtd-search-form" method="get">
<input aria-label="Search docs" name="q" placeholder="Search docs" title="Type search term here" type="text"/>
</form>
</div>
</div>
<div aria-label="Navigation menu" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<ul>
<li class="toctree-l1"><a class="reference internal" href="..">Podzone Introduction</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../QApps/">Business Requirements</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Tasklist/">Task List</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../vminventory/">Virtual Machine Inventory</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../servers/">Server Inventory</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../raspberrypis/">IoT Inventory</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../inventory/">Hosts Inventory</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../network/">Network Topology</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../siteStructure/">Site Structure and sources</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/">Tooling</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../workstation/">Workstation Config</a>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal current" href="./">Service Dependencies</a>
<ul class="current">
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ingress/">Request Routing</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../technical/">Implementation Notes</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../technicalCeph/">Storage Cluster</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../technicalApplication/">Application Build Notes</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../technicalPrometheus/">Monitoring Build Notes</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../applicationBuild/">Application Build</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Issues/">Issues</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ResearchReferences/">Research References</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../TroubleshootingReferences/">Troubleshooting References</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../deprecated/">Deprecated</a>
</li>
</ul>
</div>
</div>
</nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift">
<nav aria-label="Mobile navigation menu" class="wy-nav-top" role="navigation">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href="..">Podzone</a>
</nav>
<div class="wy-nav-content">
<div class="rst-content"><div aria-label="breadcrumbs navigation" role="navigation">
<ul class="wy-breadcrumbs">
<li><a aria-label="Docs" class="icon icon-home" href=".."></a></li>
<li class="breadcrumb-item active">Service Dependencies</li>
<li class="wy-breadcrumbs-aside">
</li>
</ul>
<hr/>
</div>
<div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
<div class="section" itemprop="articleBody">
<h1 id="external-services">External Services</h1>
<p>Non functional services requirements are as follows:</p>
<ol>
<li>Storage</li>
<li>Internet ingress</li>
<li>Application container</li>
<li>Database</li>
<li>Internet name service (DNS)</li>
<li>Certificate for https</li>
</ol>
<p>These are currently provisioned as follows</p>
<ol>
<li>Storage is supplied to the network using a NFS server, sigiriya</li>
<li>Internet ingress is implemented using fibre router port forwarding to multiple internal network IP:Port listeners</li>
<li>The application container is Zope, running in a VirtualBox host on mac host bukit</li>
<li>The database is Postgres, running in a VirtualBox host on mac host bukit</li>
<li>Updating of the DynDns host to IP mappings is managed by the fibre router</li>
<li>The https certificate is managed using certbot on bukit</li>
</ol>
<p>There are a number of these services that are implemented in such a way that they represent a single point of failure. This is not avoidable in the case of functionality provided by the fibre router. All other services can be highly available.</p>
<p>The following changes are required:</p>
<ol>
<li>Migrate from NFS to distributed storage. Ceph has been selected</li>
<li>Internet ingress fan-out will be handled by the k8s cluster. The router will only forward ports 80 and 443 to the cluster lbr (ovoo)</li>
<li>Zope to be packaged and managed using k8s</li>
<li>Postgres packaging for k8s</li>
<li>Since multiple hosts IP mappings are required, and the fibre router being limited to one host update, this function moves out of the router. Ideally packaged for k8s.</li>
<li>Kubernetes Certificate Manager to be used to update https certificates</li>
</ol>
<div class="mermaid">---
title: Original application services
---
graph TD
subgraph Q Solutions
  subgraph  Mac: bukit
    subgraph VirtualBox: ularu 
      subgraph Zope Server
        QApps
      end
      subgraph Postgres
        qappsDB
      end
    end
    subgraph Apache
      WebSites
    end
    subgraph certbot
      qsolutions.endoftheinternet.org
    end
  end
  subgraph  Fibre router
    subgraph DynDns Updater
      qsolutions.endoftheinternet.org
    end
    subgraph WAN to LAN port forwarding
      :80-bukit:443
    end
  end
  subgraph  Mac: sigiriya
    subgraph Network Storage 
      nfs-service[(/srv/nfs/)]
    end
  end
end
</div>
<div class="mermaid">---
title: Refactored application services
---
graph LR
subgraph Q Solutions
  subgraph  Fibre router
    subgraph WAN to LAN port forwarding
      :80-ovoo:443
    end
  end
  subgraph Ceph storage cluster
    subgraph sigiriya
      /dev/hdb
    end
    subgraph bukit
      /dev/loop1
    end
    subgraph james
      /dev/hdc
    end
  end
  subgraph Prometheus
    sigiriya:9090
  end
  subgraph  kubernetes cluster
    subgraph Zope Server
      QApps
    end
    subgraph Postgres
      qappsDB
    end
    subgraph Apache1
      musings
    end
    subgraph Apache2
      PodzoneDocs
    end
    subgraph DynDns Updater
      direction LR
      southern.podzone.net
      musings.thruhere.net,
      qsolutions.endoftheinternet.org
    end
    subgraph Certificate Manager
      direction LR
      https://southern.podzone.net
      https://musings.thruhere.net,
      https://qsolutions.endoftheinternet.org
    end

  end
end
</div>
</div>
</div><footer>
<div aria-label="Footer Navigation" class="rst-footer-buttons" role="navigation">
<a class="btn btn-neutral float-left" href="../workstation/" title="Workstation Config"><span class="icon icon-circle-arrow-left"></span> Previous</a>
<a class="btn btn-neutral float-right" href="../ingress/" title="Request Routing">Next <span class="icon icon-circle-arrow-right"></span></a>
</div>
<hr/>
<div role="contentinfo">
<!-- Copyright etc -->
</div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
</div>
</div>
</section>
</div>
<div aria-label="Versions" class="rst-versions" role="note">
<span class="rst-current-version" data-toggle="rst-current-version">
<span><a href="../workstation/" style="color: #fcfcfc">« Previous</a></span>
<span><a href="../ingress/" style="color: #fcfcfc">Next »</a></span>
</span>
</div>
<script src="../js/jquery-3.6.0.min.js"></script>
<script>var base_url = "..";</script>
<script src="../js/theme_extra.js"></script>
<script src="../js/theme.js"></script>
<script src="../search/main.js"></script>
<script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
mermaid.initialize({});</script></body>
</html>
